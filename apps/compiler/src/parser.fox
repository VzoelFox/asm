; ============================================================================
; Morph Self-Hosted Compiler - Parser Module
; ============================================================================
;
; Version: 0.3.0 (Modular ID-Based)
; Updated: 2026-01-05
;
; This is the main parser entry point. It imports all helper and dispatcher
; modules via ID-based system, then provides parse_source_lines() function.
;
; Engineering: Kiro (AWS Q CLI Agent)
; Reference: docs/MODULAR_ARCHITECTURE.md
; Original architecture by: Claude Code (Anthropic)
;
; For archived versions, see: apps/compiler/src/archive/
; ============================================================================

; Standard Library
Ambil 310, 311, 312, 313, 314, 315, 316 ; Buffer
Ambil 318, 319 ; File IO
Ambil 320, 321, 322, 323, 324 ; Format
Ambil 330, 331, 332, 333 ; Hashmap
Ambil 340, 341, 342, 343, 344 ; Vector
Ambil 380, 381, 382, 383, 384, 385, 386, 387, 388 ; String Utils
Ambil 390, 391 ; str_to_int, str_index_of

; Parser Helpers (ID-based import)
Ambil 1100, 1101, 1102, 1103 ; parser_helpers_import
Ambil 1110, 1111, 1112 ; parser_helpers_struct
Ambil 1120, 1121 ; parser_helpers_fungsi
Ambil 1122, 1123, 1124, 1125 ; parser_helpers_jika
Ambil 1126, 1127 ; parser_helpers_loop
Ambil 1130, 1131, 1132, 1133, 1134, 1135, 1136, 1137, 1138, 1139 ; parser_helpers_stmt

; Parser Dispatchers (ID-based import)
Ambil 1140 ; parser_dispatch_import
Ambil 1141 ; parser_dispatch_struct
Ambil 1142 ; parser_dispatch_control
Ambil 1143 ; parser_dispatch_var_struct
Ambil 1144 ; parser_dispatch_var_simple
Ambil 1145 ; parser_dispatch_cetak
Ambil 1146 ; parser_dispatch_panggil

fungsi parse_source_lines(lines)
  var line_count = vec_len(lines)
  var line_idx = 0

  selama (line_idx < line_count)
    var raw_line = vec_get(lines, line_idx)

    var parts = str_split_once(raw_line, 59)
    var line_no_comment = vec_get(parts, 0)
    var line = str_trim(line_no_comment)
    var line_len = str_len(line)

    jika (line_len > 0)
       panggil dispatch_import(line)
       panggil dispatch_struct(line)
       panggil dispatch_control(line)
       panggil dispatch_var(line)
       panggil dispatch_cetak(line)
       panggil dispatch_panggil(line)
    tutup_jika

    line_idx = line_idx + 1
  tutup_selama
tutup_fungsi
