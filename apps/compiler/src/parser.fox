; ============================================================================
; Morph Self-Hosted Compiler - Parser Module
; ============================================================================
;
; Version: 0.3.0 (Modular ID-Based)
; Updated: 2026-01-05
;
; This is the main parser entry point. It imports all helper and dispatcher
; modules via ID-based system, then provides parse_source_lines() function.
;
; Engineering: Kiro (AWS Q CLI Agent)
; Reference: docs/MODULAR_ARCHITECTURE.md
; Original architecture by: Claude Code (Anthropic)
;
; For archived versions, see: apps/compiler/src/archive/
; ============================================================================

; Standard Library (File-based)
ambil "lib/vector.fox"
ambil "lib/string_utils.fox"

; Parser Helpers (File-based)
ambil "apps/compiler/src/parser_helpers_import.fox"
ambil "apps/compiler/src/parser_helpers_struct.fox"
ambil "apps/compiler/src/parser_helpers_fungsi.fox"
ambil "apps/compiler/src/parser_helpers_jika.fox"
ambil "apps/compiler/src/parser_helpers_loop.fox"
ambil "apps/compiler/src/parser_helpers_stmt.fox"

; Parser Dispatchers (File-based)
ambil "apps/compiler/src/parser_dispatch_import.fox"
ambil "apps/compiler/src/parser_dispatch_struct.fox"
ambil "apps/compiler/src/parser_dispatch_control.fox"
ambil "apps/compiler/src/parser_dispatch_var_struct.fox"
ambil "apps/compiler/src/parser_dispatch_var_simple.fox"
ambil "apps/compiler/src/parser_dispatch_cetak.fox"
ambil "apps/compiler/src/parser_dispatch_panggil.fox"

fungsi parse_source_lines(lines)
  var line_count = vec_len(lines)
  var line_idx = 0

  selama (line_idx < line_count)
    var raw_line = vec_get(lines, line_idx)

    var parts = str_split_once(raw_line, 59)
    var line_no_comment = vec_get(parts, 0)
    var line = str_trim(line_no_comment)
    var line_len = str_len(line)

    jika (line_len > 0)
       panggil dispatch_import(line)
       panggil dispatch_struct(line)
       panggil dispatch_control(line)
       panggil dispatch_var(line)
       panggil dispatch_cetak(line)
       panggil dispatch_panggil(line)
    tutup_jika

    line_idx = line_idx + 1
  tutup_selama
tutup_fungsi
